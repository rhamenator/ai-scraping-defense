# Example custom rule
SecRule REQUEST_HEADERS:User-Agent "BadBot" "id:1000,phase:1,deny,log,msg:'Block BadBot'"

# XXE (XML External Entity) Protection Rules
# Block DTD declarations in XML requests
SecRule REQUEST_BODY "@rx (?i)<!DOCTYPE" \
    "id:2001,\
    phase:2,\
    deny,\
    status:403,\
    log,\
    msg:'XXE Attack: DOCTYPE declaration detected',\
    severity:CRITICAL,\
    tag:'application-multi',\
    tag:'language-xml',\
    tag:'OWASP_CRS',\
    tag:'attack-xxe'"

# Block ENTITY declarations in XML requests
SecRule REQUEST_BODY "@rx (?i)<!ENTITY" \
    "id:2002,\
    phase:2,\
    deny,\
    status:403,\
    log,\
    msg:'XXE Attack: ENTITY declaration detected',\
    severity:CRITICAL,\
    tag:'application-multi',\
    tag:'language-xml',\
    tag:'OWASP_CRS',\
    tag:'attack-xxe'"

# Block SYSTEM keyword in XML (used for external entity references)
SecRule REQUEST_BODY "@rx (?i)<!(?:DOCTYPE|ENTITY)[^>]*SYSTEM" \
    "id:2003,\
    phase:2,\
    deny,\
    status:403,\
    log,\
    msg:'XXE Attack: SYSTEM entity reference detected',\
    severity:CRITICAL,\
    tag:'application-multi',\
    tag:'language-xml',\
    tag:'OWASP_CRS',\
    tag:'attack-xxe'"

# Block PUBLIC keyword in XML (used for external entity references)
SecRule REQUEST_BODY "@rx (?i)<!(?:DOCTYPE|ENTITY)[^>]*PUBLIC" \
    "id:2004,\
    phase:2,\
    deny,\
    status:403,\
    log,\
    msg:'XXE Attack: PUBLIC entity reference detected',\
    severity:CRITICAL,\
    tag:'application-multi',\
    tag:'language-xml',\
    tag:'OWASP_CRS',\
    tag:'attack-xxe'"

# Block file:// protocol in XML content
SecRule REQUEST_BODY "@rx (?i)file://" \
    "id:2005,\
    phase:2,\
    deny,\
    status:403,\
    log,\
    msg:'XXE Attack: file protocol detected in request',\
    severity:HIGH,\
    tag:'application-multi',\
    tag:'language-xml',\
    tag:'OWASP_CRS',\
    tag:'attack-xxe'"

# Block expect:// protocol (PHP wrapper attack)
SecRule REQUEST_BODY "@rx (?i)expect://" \
    "id:2006,\
    phase:2,\
    deny,\
    status:403,\
    log,\
    msg:'XXE Attack: expect protocol detected in request',\
    severity:HIGH,\
    tag:'application-multi',\
    tag:'language-xml',\
    tag:'OWASP_CRS',\
    tag:'attack-xxe'"

# Block php:// protocol (PHP wrapper attack)
SecRule REQUEST_BODY "@rx (?i)php://" \
    "id:2007,\
    phase:2,\
    deny,\
    status:403,\
    log,\
    msg:'XXE Attack: PHP protocol detected in request',\
    severity:HIGH,\
    tag:'application-multi',\
    tag:'language-xml',\
    tag:'OWASP_CRS',\
    tag:'attack-xxe'"
